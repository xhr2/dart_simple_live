build-windows:
  runs-on: windows-latest
  permissions:
    contents: write

  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.38.x"
        cache: true

    - name: Enable Flutter Desktop
      run: flutter config --enable-windows-desktop

    - name: Restore Packages
      run: |
        cd simple_live_app
        flutter pub get

    - name: Install flutter_distributor
      run: dart pub global activate flutter_distributor

    - name: Build Windows
      run: |
        cd simple_live_app
        flutter_distributor package --platform windows --targets msix,zip --skip-clean

    - name: Show build output
      run: |
        cd simple_live_app
        echo "======= Windows build output ======="
        ls -R build

    - name: Upload Windows APP to Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: windows
        path: |
          simple_live_app/build/**/**/*.msix
          simple_live_app/build/**/**/*.zip
